<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Nachoneko</title>
        <link rel="stylesheet" href="style2.css">
    </head>
    <body>
        <h2>Nachoneko</h2>
        <div class="box">
            <label>
                <input type="checkbox" class="checkBox" id="chk1">
                <i></i>
            </label>
            <label>
                <input type="checkbox" class="checkBox" id="chk2">
                <i></i>
            </label>
            <label>
                <input type="checkbox" class="checkBox" id="chk3">
                <i></i>
            </label>
        </div>
        <!-- https\://rarebox.pages.dev/voices/aac/我是你爹 -->
        <button onclick='handleReset("voice/AH")' class="reset">reset</button>
        <script>
            async function play(name) {
                console.log(name);
                const buffer = await getBuffer(name + ".aac");
                buffer && playAudio(buffer);
            }
            const audioContext = new AudioContext();
            const playAudio = function (buffer) {
                const source = audioContext.createBufferSource();
                source.buffer = buffer;
                source.connect(audioContext.destination);
                source.start();
            };

            const getBuffer = function (url) {
                const request = new XMLHttpRequest();
                return new Promise((resolve, reject) => {
                    request.open("GET", url, true);
                    request.responseType = "arraybuffer";
                    request.onload = () => {
                    audioContext.decodeAudioData(request.response, (buffer) =>
                        buffer ? resolve(buffer) : reject("decoding error")
                    );
                    };
                    request.onerror = (error) => reject(error);
                    request.send();
                });
            };

            let checkboxes = Array.from(document.querySelectorAll('input[type="checkbox"]'));

            checkboxes.forEach(checkbox => {
                checkbox.onclick = function() {
                    if (this.checked) {
                        this.disabled = true;
                    }
                }
            });

            async function handleReset(name) {
                console.log(name);
                checkboxes.forEach(checkbox => {
                    checkbox.disabled = false;
                    checkbox.checked = false;
                });
                await play(name);
            }
        </script>
    </body>
</html>
